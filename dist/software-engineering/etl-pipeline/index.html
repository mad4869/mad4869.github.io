<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="description" content="MAkbarD's blog"><meta name="viewport" content="width=device-width"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v4.9.2"><meta name="og:image" content="/img/blog/logo.svg"><title>ETL Pipeline | MAD4869</title><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><link rel="stylesheet" href="/_astro/index.CtxG5iuT.css"><script type="module" src="/_astro/hoisted.DZL4CV8D.js"></script></head> <body> <header class="w-screen px-px"> <nav class="flex items-center justify-between w-full px-16 py-4 border shadow-lg text-fuchsia-800 border-fuchsia-800 rounded-b-3xl shadow-fuchsia-200/20"> <a href="/" class="text-3xl font-bold" title="Home"> <img src="/_astro/logo.DoQbXR2Z_Z1GL1ve.svg" alt="Logo Blog" loading="lazy" class="drop-shadow-[0_0_10px_rgba(232,121,249,0.5)]" width="50" height="16" decoding="async"> </a> <ul class="flex items-center justify-center gap-8"> <li title="Self-introduction"> <a href="/about" class="pb-1 transition-colors border-fuchsia-400 hover:text-fuchsia-400">
About
</a> </li> <li title="Software engineering portfolio"> <a href="/software-engineering" class="pb-1 transition-colors border-fuchsia-400 hover:text-fuchsia-400">
Software Engineering
</a> </li> <li title="Writing portfolio"> <a href="/writing" class="pb-1 transition-colors border-fuchsia-400 hover:text-fuchsia-400">
Writing
</a> </li> <li title="Some random rambling about anything"> <a href="/notes" class="pb-1 transition-colors border-fuchsia-400 hover:text-fuchsia-400">
Notes
</a> </li> </ul> <ul class="flex items-center justify-center gap-4"> <li class="transition-all hover:text-fuchsia-400 hover:scale-110" title="Go to Twitter"> <a href="https://twitter.com/MAD4869" target="_blank"> <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg> </a> </li> <li class="transition-all hover:text-fuchsia-400 hover:scale-110" title="Go to Github"> <a href="https://github.com/mad4869" target="_blank"> <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 480 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"></path></svg> </a> </li> <li class="transition-all hover:text-fuchsia-400 hover:scale-110" title="Go to Wattpad"> <a href="https://www.wattpad.com/user/aconitin_4869" target="_blank"> <svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M13.034 3.09c-1.695.113-3.9 2.027-6.9 6.947.245-2.758.345-4.716-.857-5.743-.823-.702-2.764-.974-3.926.536C.18 6.349-.09 9.312.024 12.432c.238 6.518 2.544 8.487 4.59 8.487h.001c3.623 0 4.13-4.439 6.604-8.4-.09 1.416-.008 2.668.266 3.532 1.078 3.398 4.784 3.663 6.467.21 2.374-4.87 3.058-6.016 5.453-9.521 1.58-2.314-.252-3.812-2.374-2.735-1.09.554-2.86 1.935-5.065 4.867.387-2.23.28-5.996-2.932-5.782z"></path></svg> </a> </li> <li class="transition-transform hover:scale-110" title="Go to KaryaKarsa"> <a href="https://karyakarsa.com/aconitin/" target="_blank"> <img src="/_astro/logo-kk.qwGrKF09_Z1sqeHs.svg" alt="Logo KaryaKarsa" loading="lazy" width="10" height="10" decoding="async"> </a> </li> <li class="transition-transform hover:scale-110" title="Go to Kwikku"> <a href="https://www.kwikku.com/mad4869" target="_blank"> <img src="/_astro/logo-kwik.CgTZu3Cm_Z9Bwy4.svg" alt="Logo Kwikku" loading="lazy" width="15" height="15" decoding="async"> </a> </li> </ul> </nav> </header>  <main class="min-h-[calc(100dvh-8rem)] text-fuchsia-400 py-8 px-16 space-y-4"> <section class="flex items-center justify-between"> <div> <h1 class="text-3xl font-bold">ETL Pipeline</h1> <h6 class="">A pipeline to manage simple ETL process from various sources.</h6> </div> <div> <p class="text-xs text-fuchsia-400/50">Pandas</p><p class="text-xs text-fuchsia-400/50">Luigi</p><p class="text-xs text-fuchsia-400/50">Data Engineering</p> </div> </section> <img src="/_astro/overtime-system.lGE-G_8n_Z1BYCEV.webp" alt="Hero Image of ETL Pipeline" class="max-w-full mx-auto transition-shadow shadow-lg rounded-xl shadow-fuchsia-200/20 hover:shadow-fuchsia-200/40" loading="lazy" width="1918" height="954" decoding="async"> <article class="prose prose-img:rounded-xl text-fuchsia-200 prose-headings:text-fuchsia-400 dark:prose-invert prose-a:text-fuchsia-200 hover:prose-a:text-fuchsia-800"> <h2 id="background">Background</h2>
<p>A data engineer is required to build an ETL pipeline to address data issues for other departments.</p>
<h3 id="sales-team">Sales Team</h3>
<p>The sales team has data stored in a PostgreSQL database, but the data contains many missing values and is formatted incorrectly.</p>
<h3 id="product-team">Product Team</h3>
<p>The product team has electronic product pricing data in a CSV file, however the data is in poor condition and requires significant cleaning.</p>
<h3 id="data-scientist-team">Data Scientist Team</h3>
<p>The data scientist team needs data to build a Natural Language Processing (NLP) model, but currently lacks access to any.</p>
<h2 id="project-explanation">Project Explanation</h2>
<h3 id="requirements-gathering--proposed-solution">Requirements Gathering &#x26; Proposed Solution</h3>
<p>The challenge:</p>
<ol>
<li>Existing sales and marketing data require further processing to be usable.</li>
<li>Text data needed for the NLP model is currently unavailable.</li>
</ol>
<p>The solution:</p>
<ol>
<li><strong>ETL pipeline development.</strong> Extract data from existing sales and marketing sources and then transform the extracted data to a usable format, extract relevant text data from a website using web scraping and clean it for NLP use, and finally load all transformed data into a single, centralized data source.</li>
<li><strong>Scheduling.</strong> Implement a scheduler to ensure the pipeline runs regularly and automatically.</li>
</ol>
<h3 id="etl-pipeline-design">ETL Pipeline Design</h3>
<p>The pipeline follows an ETL procedure:</p>
<ul>
<li>Extract</li>
<li>Transform</li>
<li>Load</li>
</ul>
<!-- ![ETL Pipeline Design](./docs/etl-pipeline-design.jpg) -->
<p>During the <strong>Extraction</strong> phase, data is extracted from three available sources: a CSV file, a PostgreSQL database, and a website. Data from the CSV file and the database is directly extracted using <code>pandas</code> methods for reading CSV files and database queries, respectively. Data from the website is obtained through web scraping using a combination of <code>requests</code> and <code>Beautiful Soup</code> libraries. All the data is then converted into <code>pandas</code> DataFrames for further processing.</p>
<p>Following extraction, the DataFrames undergo a <strong>Validation</strong> process to inspect data details such as shape (count of rows and columns), data types of each column, and the presence of missing values.</p>
<p>Next, the DataFrames proceed to the <strong>Transformation</strong> phase where they undergo processing to meet project requirements. The process is utilizing <code>pandas</code> methods to clean the data, replace missing values, drop unnecessary columns, and perform other necessary transformations.</p>
<p>Finally, the transformed DataFrames are loaded into distinct tables within a PostgreSQL database during the <strong>Load</strong> phase.</p>
<h3 id="etl-implementation">ETL Implementation</h3>
<p>This project is using <code>luigi</code> as a tool to build an ETL pipeline.</p>
<h4 id="extraction">Extraction</h4>
<p>Extracting data from a CSV file:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="py"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> luigi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> ExtractProductsDataFromCSV</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">luigi</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Task</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> requires</span><span style="color:#E1E4E8">(self):</span></span>
<span class="line"><span style="color:#F97583">        pass</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> run</span><span style="color:#E1E4E8">(self):</span></span>
<span class="line"><span style="color:#F97583">        pass</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> output</span><span style="color:#E1E4E8">(self):</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> luigi.LocalTarget(</span><span style="color:#9ECBFF">"/home/mad4869/Documents/pacmann/data-engineering/etl-pipeline/data/raw/products_data.csv"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span></code></pre>
<p>Extracting data from a PostgreSQL database:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="py"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> pandas </span><span style="color:#F97583">as</span><span style="color:#E1E4E8"> pd</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> psycopg2</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> os</span></span>
<span class="line"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> dotenv </span><span style="color:#F97583">import</span><span style="color:#E1E4E8"> load_dotenv</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">load_dotenv()</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> extract_db</span><span style="color:#E1E4E8">() -> pd.DataFrame:</span></span>
<span class="line"><span style="color:#79B8FF">    DB_NAME</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> os.getenv(</span><span style="color:#9ECBFF">"DB_NAME"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#79B8FF">    DB_USER</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> os.getenv(</span><span style="color:#9ECBFF">"DB_USER"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#79B8FF">    DB_PASSWORD</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> os.getenv(</span><span style="color:#9ECBFF">"DB_PASSWORD"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#79B8FF">    DB_HOST</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> os.getenv(</span><span style="color:#9ECBFF">"DB_HOST"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#79B8FF">    DB_PORT</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> os.getenv(</span><span style="color:#9ECBFF">"DB_PORT"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    conn </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> psycopg2.connect(</span></span>
<span class="line"><span style="color:#FFAB70">        dbname</span><span style="color:#F97583">=</span><span style="color:#79B8FF">DB_NAME</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">user</span><span style="color:#F97583">=</span><span style="color:#79B8FF">DB_USER</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">password</span><span style="color:#F97583">=</span><span style="color:#79B8FF">DB_PASSWORD</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">host</span><span style="color:#F97583">=</span><span style="color:#79B8FF">DB_HOST</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">port</span><span style="color:#F97583">=</span><span style="color:#79B8FF">DB_PORT</span></span>
<span class="line"><span style="color:#E1E4E8">    )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    query </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "SELECT * FROM amazon_sales_data"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    df </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> pd.read_sql(query, conn)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    conn.close()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> df</span></span>
<span class="line"></span></code></pre>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="py"><code><span class="line"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> extract.extract_db </span><span style="color:#F97583">import</span><span style="color:#E1E4E8"> extract_db</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> ExtractSalesDataFromDB</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">ForceableTask</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> requires</span><span style="color:#E1E4E8">(self):</span></span>
<span class="line"><span style="color:#F97583">        pass</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> run</span><span style="color:#E1E4E8">(self):</span></span>
<span class="line"><span style="color:#E1E4E8">        df </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> extract_db()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">        df.to_csv(</span><span style="color:#79B8FF">self</span><span style="color:#E1E4E8">.output().path, </span><span style="color:#FFAB70">index</span><span style="color:#F97583">=</span><span style="color:#79B8FF">False</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> output</span><span style="color:#E1E4E8">(self):</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> luigi.LocalTarget(</span><span style="color:#9ECBFF">"/home/mad4869/Documents/pacmann/data-engineering/etl-pipeline/data/raw/sales_data.csv"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span></code></pre>
<p>Extracting data from a website is accomplished by scraping the <strong>Detikinet</strong> website (inet.detik.com). Detik was selected for convenience reason and because their policy allows the use of their content for non-commercial purposes.</p>
<!-- ![Detik's Copyright Statement](/docs/detik-copyright-statement.png) -->
<p>Source: <a href="https://www.detik.com/copyright">detik.com</a></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="py"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> requests</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> pandas </span><span style="color:#F97583">as</span><span style="color:#E1E4E8"> pd</span></span>
<span class="line"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> bs4 </span><span style="color:#F97583">import</span><span style="color:#E1E4E8"> BeautifulSoup</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> extract_web</span><span style="color:#E1E4E8">() -> pd.DataFrame:</span></span>
<span class="line"><span style="color:#79B8FF">    URL</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "https://inet.detik.com/indeks"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    full_data </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> []</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> page </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#E1E4E8">        resp </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> requests.get(</span><span style="color:#F97583">f</span><span style="color:#9ECBFF">"</span><span style="color:#79B8FF">{URL}</span><span style="color:#9ECBFF">/</span><span style="color:#79B8FF">{</span><span style="color:#E1E4E8">page</span><span style="color:#79B8FF">}</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> resp.status_code </span><span style="color:#F97583">==</span><span style="color:#79B8FF"> 200</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">            soup </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> BeautifulSoup(resp.text, </span><span style="color:#9ECBFF">"html.parser"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">            # get all the articles</span></span>
<span class="line"><span style="color:#E1E4E8">            medias </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> soup.find_all(</span><span style="color:#9ECBFF">"div"</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">class_</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"media"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">            for</span><span style="color:#E1E4E8"> media </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> medias:</span></span>
<span class="line"><span style="color:#6A737D">                # get the article's link</span></span>
<span class="line"><span style="color:#E1E4E8">                link </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> media.find(</span><span style="color:#9ECBFF">"a"</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">class_</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"media__link"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">                href </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> link.get(</span><span style="color:#9ECBFF">"href"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">                # filter out videos and pictures articles</span></span>
<span class="line"><span style="color:#F97583">                if</span><span style="color:#9ECBFF"> "20.detik.com"</span><span style="color:#F97583"> not</span><span style="color:#F97583"> in</span><span style="color:#E1E4E8"> href </span><span style="color:#F97583">and</span><span style="color:#9ECBFF"> "fotoinet"</span><span style="color:#F97583"> not</span><span style="color:#F97583"> in</span><span style="color:#E1E4E8"> href:</span></span>
<span class="line"><span style="color:#E1E4E8">                    content </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> requests.get(href)</span></span>
<span class="line"><span style="color:#E1E4E8">                    content_soup </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> BeautifulSoup(content.text, </span><span style="color:#9ECBFF">"html.parser"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">                    content_detail </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> content_soup.find(</span><span style="color:#9ECBFF">"article"</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">class_</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"detail"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">                    if</span><span style="color:#E1E4E8"> content_detail:</span></span>
<span class="line"><span style="color:#E1E4E8">                        content_title </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#E1E4E8">                            content_detail.find(</span><span style="color:#9ECBFF">"h1"</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">class_</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"detail__title"</span><span style="color:#E1E4E8">).text</span></span>
<span class="line"><span style="color:#F97583">                            or</span><span style="color:#79B8FF"> None</span></span>
<span class="line"><span style="color:#E1E4E8">                        )</span></span>
<span class="line"><span style="color:#E1E4E8">                        content_author </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#E1E4E8">                            content_detail.find(</span><span style="color:#9ECBFF">"div"</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">class_</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"detail__author"</span><span style="color:#E1E4E8">).text</span></span>
<span class="line"><span style="color:#F97583">                            or</span><span style="color:#79B8FF"> None</span></span>
<span class="line"><span style="color:#E1E4E8">                        )</span></span>
<span class="line"><span style="color:#E1E4E8">                        content_date </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#E1E4E8">                            content_detail.find(</span><span style="color:#9ECBFF">"div"</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">class_</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"detail__date"</span><span style="color:#E1E4E8">).text</span></span>
<span class="line"><span style="color:#F97583">                            or</span><span style="color:#79B8FF"> None</span></span>
<span class="line"><span style="color:#E1E4E8">                        )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">                        content_body </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#E1E4E8">                            content_detail.find(</span><span style="color:#9ECBFF">"div"</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">class_</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"detail__body"</span><span style="color:#E1E4E8">).text</span></span>
<span class="line"><span style="color:#F97583">                            or</span><span style="color:#79B8FF"> None</span></span>
<span class="line"><span style="color:#E1E4E8">                        )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">                        content_data </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#9ECBFF">                            "title"</span><span style="color:#E1E4E8">: content_title,</span></span>
<span class="line"><span style="color:#9ECBFF">                            "author"</span><span style="color:#E1E4E8">: content_author,</span></span>
<span class="line"><span style="color:#9ECBFF">                            "date"</span><span style="color:#E1E4E8">: content_date,</span></span>
<span class="line"><span style="color:#9ECBFF">                            "body"</span><span style="color:#E1E4E8">: content_body,</span></span>
<span class="line"><span style="color:#E1E4E8">                        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">                        full_data.append(content_data)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    df </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> pd.DataFrame(full_data)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> df</span></span>
<span class="line"></span></code></pre>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="py"><code><span class="line"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> extract.extract_web </span><span style="color:#F97583">import</span><span style="color:#E1E4E8"> extract_web</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> ExtractTextDataFromWeb</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">luigi</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Task</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> requires</span><span style="color:#E1E4E8">(self):</span></span>
<span class="line"><span style="color:#F97583">        pass</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> run</span><span style="color:#E1E4E8">(self):</span></span>
<span class="line"><span style="color:#E1E4E8">        df </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> extract_web()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">        df.to_csv(</span><span style="color:#79B8FF">self</span><span style="color:#E1E4E8">.output().path, </span><span style="color:#FFAB70">index</span><span style="color:#F97583">=</span><span style="color:#79B8FF">False</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> output</span><span style="color:#E1E4E8">(self):</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> luigi.LocalTarget(</span><span style="color:#9ECBFF">"/home/mad4869/Documents/pacmann/data-engineering/etl-pipeline/data/raw/web_text_data.csv"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span></code></pre>
<h4 id="validation">Validation</h4>
<p>Validating the raw data:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="py"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> pandas </span><span style="color:#F97583">as</span><span style="color:#E1E4E8"> pd</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> validate_data</span><span style="color:#E1E4E8">(df: pd.DataFrame, table: </span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">) -> </span><span style="color:#79B8FF">None</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#79B8FF">    print</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"========== Start Pipeline Validation =========="</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#79B8FF">    print</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">""</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    # get shape of the dataframe</span></span>
<span class="line"><span style="color:#E1E4E8">    n_rows </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> df.shape[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">    n_cols </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> df.shape[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF">    print</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">f</span><span style="color:#9ECBFF">"Tabel </span><span style="color:#79B8FF">{</span><span style="color:#E1E4E8">table</span><span style="color:#79B8FF">}</span><span style="color:#9ECBFF"> memiliki </span><span style="color:#79B8FF">{</span><span style="color:#E1E4E8">n_rows</span><span style="color:#79B8FF">}</span><span style="color:#9ECBFF"> baris dan </span><span style="color:#79B8FF">{</span><span style="color:#E1E4E8">n_cols</span><span style="color:#79B8FF">}</span><span style="color:#9ECBFF"> kolom"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#79B8FF">    print</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">""</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    cols </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> df.columns</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    # get datatype for each column</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> col </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> cols:</span></span>
<span class="line"><span style="color:#79B8FF">        print</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">f</span><span style="color:#9ECBFF">"Kolom </span><span style="color:#79B8FF">{</span><span style="color:#E1E4E8">col</span><span style="color:#79B8FF">}</span><span style="color:#9ECBFF"> memiliki tipe data </span><span style="color:#79B8FF">{</span><span style="color:#E1E4E8">df[col].dtypes</span><span style="color:#79B8FF">}</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF">    print</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">""</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    # check missing values in each column</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> col </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> cols:</span></span>
<span class="line"><span style="color:#E1E4E8">        missing_values_pct </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (df[col].isnull().sum() </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 100</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">/</span><span style="color:#79B8FF"> len</span><span style="color:#E1E4E8">(df)</span></span>
<span class="line"><span style="color:#79B8FF">        print</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#F97583">            f</span><span style="color:#9ECBFF">"Kolom </span><span style="color:#79B8FF">{</span><span style="color:#E1E4E8">col</span><span style="color:#79B8FF">}</span><span style="color:#9ECBFF"> memiliki missing values sebanyak </span><span style="color:#79B8FF">{</span><span style="color:#E1E4E8">missing_values_pct</span><span style="color:#79B8FF">}</span><span style="color:#9ECBFF">% dari total data"</span></span>
<span class="line"><span style="color:#E1E4E8">        )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF">    print</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">""</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#79B8FF">    print</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"========== End Pipeline Validation =========="</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span></code></pre>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="py"><code><span class="line"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> validate.validate_data </span><span style="color:#F97583">import</span><span style="color:#E1E4E8"> validate_data</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> ValidateData</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">luigi</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Task</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> requires</span><span style="color:#E1E4E8">(self):</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#E1E4E8">            ExtractProductsDataFromCSV(),</span></span>
<span class="line"><span style="color:#E1E4E8">            ExtractSalesDataFromDB(),</span></span>
<span class="line"><span style="color:#E1E4E8">            ExtractTextDataFromWeb(),</span></span>
<span class="line"><span style="color:#E1E4E8">        ]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> run</span><span style="color:#E1E4E8">(self):</span></span>
<span class="line"><span style="color:#E1E4E8">        tables </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [</span><span style="color:#9ECBFF">"PRODUCTS"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"SALES"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"WEB TEXT"</span><span style="color:#E1E4E8">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> index, table </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> enumerate</span><span style="color:#E1E4E8">(tables):</span></span>
<span class="line"><span style="color:#E1E4E8">            df </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> pd.read_csv(</span><span style="color:#79B8FF">self</span><span style="color:#E1E4E8">.input()[index].path)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">            validate_data(df, table)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> output</span><span style="color:#E1E4E8">(self):</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#E1E4E8">            luigi.LocalTarget(</span><span style="color:#9ECBFF">"/home/mad4869/Documents/pacmann/data-engineering/etl-pipeline/data/validated/products_data.csv"</span><span style="color:#E1E4E8">),</span></span>
<span class="line"><span style="color:#E1E4E8">            luigi.LocalTarget(</span><span style="color:#9ECBFF">"/home/mad4869/Documents/pacmann/data-engineering/etl-pipeline/data/validated/sales_data.csv"</span><span style="color:#E1E4E8">),</span></span>
<span class="line"><span style="color:#E1E4E8">            luigi.LocalTarget(</span><span style="color:#9ECBFF">"/home/mad4869/Documents/pacmann/data-engineering/etl-pipeline/data/validated/web_text_data.csv"</span><span style="color:#E1E4E8">),</span></span>
<span class="line"><span style="color:#E1E4E8">        ]</span></span>
<span class="line"></span></code></pre>
<h4 id="transformation">Transformation</h4>
<p>Transforming the product data involves dropping unnecessary columns and filling missing values.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="py"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> pandas </span><span style="color:#F97583">as</span><span style="color:#E1E4E8"> pd</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> transform_products_data</span><span style="color:#E1E4E8">(df: pd.DataFrame) -> pd.DataFrame:</span></span>
<span class="line"><span style="color:#6A737D">    # drop unnecessary columns</span></span>
<span class="line"><span style="color:#E1E4E8">    columns_to_drop </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#9ECBFF">        "ean"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">        "Unnamed: 26"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">        "Unnamed: 27"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">        "Unnamed: 28"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">        "Unnamed: 29"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">        "Unnamed: 30"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    ]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    df.drop(</span><span style="color:#FFAB70">columns</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">columns_to_drop, </span><span style="color:#FFAB70">inplace</span><span style="color:#F97583">=</span><span style="color:#79B8FF">True</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    # fill missing values</span></span>
<span class="line"><span style="color:#E1E4E8">    df.fillna(</span><span style="color:#9ECBFF">"Not Found"</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">inplace</span><span style="color:#F97583">=</span><span style="color:#79B8FF">True</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> df</span></span>
<span class="line"></span></code></pre>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="py"><code><span class="line"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> transform.transform_products_data </span><span style="color:#F97583">import</span><span style="color:#E1E4E8"> transform_products_data</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> TransformProductsData</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">luigi</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Task</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> requires</span><span style="color:#E1E4E8">(self):</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> ExtractProductsDataFromCSV()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> run</span><span style="color:#E1E4E8">(self):</span></span>
<span class="line"><span style="color:#E1E4E8">        df </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> pd.read_csv(</span><span style="color:#79B8FF">self</span><span style="color:#E1E4E8">.input().path)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">        transformed_df </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> transform_products_data(df)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">        transformed_df.to_csv(</span><span style="color:#79B8FF">self</span><span style="color:#E1E4E8">.output().path, </span><span style="color:#FFAB70">index</span><span style="color:#F97583">=</span><span style="color:#79B8FF">False</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> output</span><span style="color:#E1E4E8">(self):</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> luigi.LocalTarget(</span><span style="color:#9ECBFF">"/home/mad4869/Documents/pacmann/data-engineering/etl-pipeline/data/transformed/products_data.csv"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span></code></pre>
<p>Transforming the sales data involves dropping unnecessary columns and rows, and filling missing values.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="py"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> pandas </span><span style="color:#F97583">as</span><span style="color:#E1E4E8"> pd</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> transform_sales_data</span><span style="color:#E1E4E8">(df: pd.DataFrame) -> pd.DataFrame:</span></span>
<span class="line"><span style="color:#6A737D">    # drop unnecessary columns</span></span>
<span class="line"><span style="color:#E1E4E8">    columns_to_drop </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [</span><span style="color:#9ECBFF">"Unnamed: 0"</span><span style="color:#E1E4E8">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    df.drop(</span><span style="color:#FFAB70">columns</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">columns_to_drop, </span><span style="color:#FFAB70">inplace</span><span style="color:#F97583">=</span><span style="color:#79B8FF">True</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    # drop rows with missing actual price</span></span>
<span class="line"><span style="color:#E1E4E8">    df.dropna(</span><span style="color:#FFAB70">subset</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">[</span><span style="color:#9ECBFF">"actual_price"</span><span style="color:#E1E4E8">], </span><span style="color:#FFAB70">inplace</span><span style="color:#F97583">=</span><span style="color:#79B8FF">True</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    # fill missing values</span></span>
<span class="line"><span style="color:#E1E4E8">    df.fillna(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">inplace</span><span style="color:#F97583">=</span><span style="color:#79B8FF">True</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> df</span></span>
<span class="line"></span></code></pre>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="py"><code><span class="line"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> transform.transform_sales_data </span><span style="color:#F97583">import</span><span style="color:#E1E4E8"> transform_sales_data</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> TransformSalesData</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">ForceableTask</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> requires</span><span style="color:#E1E4E8">(self):</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> ExtractSalesDataFromDB()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> run</span><span style="color:#E1E4E8">(self):</span></span>
<span class="line"><span style="color:#E1E4E8">        df </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> pd.read_csv(</span><span style="color:#79B8FF">self</span><span style="color:#E1E4E8">.input().path)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">        transformed_df </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> transform_sales_data(df)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">        transformed_df.to_csv(</span><span style="color:#79B8FF">self</span><span style="color:#E1E4E8">.output().path, </span><span style="color:#FFAB70">index</span><span style="color:#F97583">=</span><span style="color:#79B8FF">False</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> output</span><span style="color:#E1E4E8">(self):</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> luigi.LocalTarget(</span><span style="color:#9ECBFF">"/home/mad4869/Documents/pacmann/data-engineering/etl-pipeline/data/transformed/sales_data.csv"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span></code></pre>
<p>Transforming the web data involves cleaning the text from irrelevant subjects and standardizing the format.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="py"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> re</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> pandas </span><span style="color:#F97583">as</span><span style="color:#E1E4E8"> pd</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> transform_web_text_data</span><span style="color:#E1E4E8">(df: pd.DataFrame) -> pd.DataFrame:</span></span>
<span class="line"><span style="color:#6A737D">    # clean the name of authors</span></span>
<span class="line"><span style="color:#E1E4E8">    df[</span><span style="color:#9ECBFF">"author"</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> df[</span><span style="color:#9ECBFF">"author"</span><span style="color:#E1E4E8">].str.replace(</span><span style="color:#9ECBFF">" - detikInet"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">""</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    # clean the title and the body</span></span>
<span class="line"><span style="color:#E1E4E8">    df[</span><span style="color:#9ECBFF">"title"</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> df[</span><span style="color:#9ECBFF">"title"</span><span style="color:#E1E4E8">].str.strip()</span></span>
<span class="line"><span style="color:#E1E4E8">    df[</span><span style="color:#9ECBFF">"body"</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> df[</span><span style="color:#9ECBFF">"body"</span><span style="color:#E1E4E8">].str.strip()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    # create a function to clean the acquired text</span></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> cleaning_text</span><span style="color:#E1E4E8">(text: </span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">) -> </span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#6A737D">        # remove whitespace</span></span>
<span class="line"><span style="color:#E1E4E8">        text_wo_whitespace </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> re.sub(</span><span style="color:#F97583">r</span><span style="color:#9ECBFF">"</span><span style="color:#79B8FF">\s</span><span style="color:#F97583">+</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">" "</span><span style="color:#E1E4E8">, text)</span></span>
<span class="line"><span style="color:#6A737D">        # add space after period</span></span>
<span class="line"><span style="color:#E1E4E8">        proper_sentences </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> re.sub(</span><span style="color:#F97583">r</span><span style="color:#9ECBFF">"</span><span style="color:#85E89D;font-weight:bold">\.</span><span style="color:#79B8FF">([a-zA-Z]</span><span style="color:#F97583">+</span><span style="color:#79B8FF">)\b</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">r</span><span style="color:#9ECBFF">"</span><span style="color:#79B8FF">.</span><span style="color:#85E89D"> \1</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">, text_wo_whitespace)</span></span>
<span class="line"><span style="color:#6A737D">        # split paragraph into sentences</span></span>
<span class="line"><span style="color:#E1E4E8">        sentences </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> proper_sentences.split(</span><span style="color:#9ECBFF">". "</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#6A737D">        # filter irrelevant sentences</span></span>
<span class="line"><span style="color:#E1E4E8">        filtered_sentences </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> filter</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#F97583">            lambda</span><span style="color:#E1E4E8"> sentence: </span><span style="color:#9ECBFF">"ADVERTISEMENT"</span><span style="color:#F97583"> not</span><span style="color:#F97583"> in</span><span style="color:#E1E4E8"> sentence</span></span>
<span class="line"><span style="color:#F97583">            and</span><span style="color:#9ECBFF"> "Baca juga:"</span><span style="color:#F97583"> not</span><span style="color:#F97583"> in</span><span style="color:#E1E4E8"> sentence</span></span>
<span class="line"><span style="color:#F97583">            and</span><span style="color:#9ECBFF"> "Simak Video"</span><span style="color:#F97583"> not</span><span style="color:#F97583"> in</span><span style="color:#E1E4E8"> sentence,</span></span>
<span class="line"><span style="color:#E1E4E8">            sentences,</span></span>
<span class="line"><span style="color:#E1E4E8">        )</span></span>
<span class="line"><span style="color:#6A737D">        # join the sentences back into a full text</span></span>
<span class="line"><span style="color:#E1E4E8">        cleaned_text </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> ". "</span><span style="color:#E1E4E8">.join(filtered_sentences)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> cleaned_text</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    df[</span><span style="color:#9ECBFF">"body"</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> df[</span><span style="color:#9ECBFF">"body"</span><span style="color:#E1E4E8">].apply(cleaning_text)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> df</span></span>
<span class="line"></span></code></pre>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="py"><code><span class="line"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> transform.transform_web_text_data </span><span style="color:#F97583">import</span><span style="color:#E1E4E8"> transform_web_text_data</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> TransformWebTextData</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">luigi</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Task</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> requires</span><span style="color:#E1E4E8">(self):</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> ExtractTextDataFromWeb()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> run</span><span style="color:#E1E4E8">(self):</span></span>
<span class="line"><span style="color:#E1E4E8">        df </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> pd.read_csv(</span><span style="color:#79B8FF">self</span><span style="color:#E1E4E8">.input().path)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">        transformed_df </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> transform_web_text_data(df)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">        transformed_df.to_csv(</span><span style="color:#79B8FF">self</span><span style="color:#E1E4E8">.output().path, </span><span style="color:#FFAB70">index</span><span style="color:#F97583">=</span><span style="color:#79B8FF">False</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> output</span><span style="color:#E1E4E8">(self):</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> luigi.LocalTarget(</span><span style="color:#9ECBFF">"/home/mad4869/Documents/pacmann/data-engineering/etl-pipeline/data/transformed/web_text_data.csv"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span></code></pre>
<h4 id="load">Load</h4>
<p>Loading the transformed data into a PostgreSQL database, including the addition of a ‘created_at’ column.:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="py"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> pandas </span><span style="color:#F97583">as</span><span style="color:#E1E4E8"> pd</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> os</span></span>
<span class="line"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> sqlalchemy </span><span style="color:#F97583">import</span><span style="color:#E1E4E8"> create_engine</span></span>
<span class="line"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> dotenv </span><span style="color:#F97583">import</span><span style="color:#E1E4E8"> load_dotenv</span></span>
<span class="line"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> datetime </span><span style="color:#F97583">import</span><span style="color:#E1E4E8"> datetime</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">load_dotenv()</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> load_data</span><span style="color:#E1E4E8">(df: pd.DataFrame, table: </span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">) -> pd.DataFrame:</span></span>
<span class="line"><span style="color:#79B8FF">    LOCAL_DB_NAME</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> os.getenv(</span><span style="color:#9ECBFF">"LOCAL_DB_NAME"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#79B8FF">    LOCAL_DB_USER</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> os.getenv(</span><span style="color:#9ECBFF">"LOCAL_DB_USER"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#79B8FF">    LOCAL_DB_PASSWORD</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> os.getenv(</span><span style="color:#9ECBFF">"LOCAL_DB_PASSWORD"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#79B8FF">    LOCAL_DB_HOST</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> os.getenv(</span><span style="color:#9ECBFF">"LOCAL_DB_HOST"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#79B8FF">    LOCAL_DB_PORT</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> os.getenv(</span><span style="color:#9ECBFF">"LOCAL_DB_PORT"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    conn </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> create_engine(</span></span>
<span class="line"><span style="color:#F97583">        f</span><span style="color:#9ECBFF">"postgresql://</span><span style="color:#79B8FF">{LOCAL_DB_USER}</span><span style="color:#9ECBFF">:</span><span style="color:#79B8FF">{LOCAL_DB_PASSWORD}</span><span style="color:#9ECBFF">@</span><span style="color:#79B8FF">{LOCAL_DB_HOST}</span><span style="color:#9ECBFF">:</span><span style="color:#79B8FF">{LOCAL_DB_PORT}</span><span style="color:#9ECBFF">/</span><span style="color:#79B8FF">{LOCAL_DB_NAME}</span><span style="color:#9ECBFF">"</span></span>
<span class="line"><span style="color:#E1E4E8">    )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    df[</span><span style="color:#9ECBFF">"created_at"</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> datetime.now()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    df.to_sql(</span><span style="color:#FFAB70">name</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">table, </span><span style="color:#FFAB70">con</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">conn, </span><span style="color:#FFAB70">if_exists</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"replace"</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">index</span><span style="color:#F97583">=</span><span style="color:#79B8FF">False</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    conn.dispose()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> df</span></span>
<span class="line"></span></code></pre>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="py"><code><span class="line"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> load.load_data </span><span style="color:#F97583">import</span><span style="color:#E1E4E8"> load_data</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> LoadData</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">ForceableTask</span><span style="color:#E1E4E8">):</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> requires</span><span style="color:#E1E4E8">(self):</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> [TransformProductsData(), TransformSalesData(), TransformWebTextData()]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> run</span><span style="color:#E1E4E8">(self):</span></span>
<span class="line"><span style="color:#E1E4E8">        products_df </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> pd.read_csv(</span><span style="color:#79B8FF">self</span><span style="color:#E1E4E8">.input()[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">].path)</span></span>
<span class="line"><span style="color:#E1E4E8">        sales_df </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> pd.read_csv(</span><span style="color:#79B8FF">self</span><span style="color:#E1E4E8">.input()[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">].path)</span></span>
<span class="line"><span style="color:#E1E4E8">        web_text_df </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> pd.read_csv(</span><span style="color:#79B8FF">self</span><span style="color:#E1E4E8">.input()[</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">].path)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">        loaded_products_df </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> load_data(products_df, </span><span style="color:#9ECBFF">"products"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        loaded_sales_df </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> load_data(sales_df, </span><span style="color:#9ECBFF">"sales"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        loaded_web_text_df </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> load_data(web_text_df, </span><span style="color:#9ECBFF">"web_text"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">        loaded_products_df.to_csv(</span><span style="color:#79B8FF">self</span><span style="color:#E1E4E8">.output()[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">].path, </span><span style="color:#FFAB70">index</span><span style="color:#F97583">=</span><span style="color:#79B8FF">False</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        loaded_sales_df.to_csv(</span><span style="color:#79B8FF">self</span><span style="color:#E1E4E8">.output()[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">].path, </span><span style="color:#FFAB70">index</span><span style="color:#F97583">=</span><span style="color:#79B8FF">False</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        loaded_web_text_df.to_csv(</span><span style="color:#79B8FF">self</span><span style="color:#E1E4E8">.output()[</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">].path, </span><span style="color:#FFAB70">index</span><span style="color:#F97583">=</span><span style="color:#79B8FF">False</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> output</span><span style="color:#E1E4E8">(self):</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#E1E4E8">            luigi.LocalTarget(</span><span style="color:#9ECBFF">"/home/mad4869/Documents/pacmann/data-engineering/etl-pipeline/data/loaded/products_data.csv"</span><span style="color:#E1E4E8">),</span></span>
<span class="line"><span style="color:#E1E4E8">            luigi.LocalTarget(</span><span style="color:#9ECBFF">"/home/mad4869/Documents/pacmann/data-engineering/etl-pipeline/data/loaded/sales_data.csv"</span><span style="color:#E1E4E8">),</span></span>
<span class="line"><span style="color:#E1E4E8">            luigi.LocalTarget(</span><span style="color:#9ECBFF">"/home/mad4869/Documents/pacmann/data-engineering/etl-pipeline/data/loaded/web_text_data.csv"</span><span style="color:#E1E4E8">),</span></span>
<span class="line"><span style="color:#E1E4E8">        ]</span></span>
<span class="line"></span></code></pre>
<p>The last step is building the pipeline by assembling all the processes involved.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="py"><code><span class="line"><span style="color:#F97583">if</span><span style="color:#79B8FF"> __name__</span><span style="color:#F97583"> ==</span><span style="color:#9ECBFF"> "__main__"</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">    luigi.build(</span></span>
<span class="line"><span style="color:#E1E4E8">        [</span></span>
<span class="line"><span style="color:#E1E4E8">            ExtractProductsDataFromCSV(),</span></span>
<span class="line"><span style="color:#E1E4E8">            ExtractSalesDataFromDB(</span><span style="color:#FFAB70">force</span><span style="color:#F97583">=</span><span style="color:#79B8FF">True</span><span style="color:#E1E4E8">),</span></span>
<span class="line"><span style="color:#E1E4E8">            ExtractTextDataFromWeb(),</span></span>
<span class="line"><span style="color:#E1E4E8">            ValidateData(),</span></span>
<span class="line"><span style="color:#E1E4E8">            TransformProductsData(),</span></span>
<span class="line"><span style="color:#E1E4E8">            TransformSalesData(</span><span style="color:#FFAB70">force</span><span style="color:#F97583">=</span><span style="color:#79B8FF">True</span><span style="color:#E1E4E8">),</span></span>
<span class="line"><span style="color:#E1E4E8">            TransformWebTextData(),</span></span>
<span class="line"><span style="color:#E1E4E8">            LoadData(</span><span style="color:#FFAB70">force</span><span style="color:#F97583">=</span><span style="color:#79B8FF">True</span><span style="color:#E1E4E8">),</span></span>
<span class="line"><span style="color:#E1E4E8">        ]</span></span>
<span class="line"><span style="color:#E1E4E8">    )</span></span>
<span class="line"></span></code></pre>
<p>The database output can be accessed using docker image available <a href="https://hub.docker.com/repository/docker/mad4869/etl_postgres/general">here.</a></p>
<h3 id="etl-scheduling">ETL Scheduling</h3>
<p>To ensure the pipeline runs regularly, it is scheduled using <code>crontab</code>. This tool executes a shell script every minute, which in turn triggers the pipeline’s execution.</p>
<p>The shell script responsible for running the pipeline:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#6A737D">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Virtual Environment Path</span></span>
<span class="line"><span style="color:#E1E4E8">VENV_PATH</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"/home/mad4869/Documents/pacmann/data-engineering/etl-pipeline/etl-venv/bin/activate"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Activate Virtual Environment</span></span>
<span class="line"><span style="color:#79B8FF">source</span><span style="color:#9ECBFF"> "</span><span style="color:#E1E4E8">$VENV_PATH</span><span style="color:#9ECBFF">"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Set Python Script</span></span>
<span class="line"><span style="color:#E1E4E8">PYTHON_SCRIPT</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"/home/mad4869/Documents/pacmann/data-engineering/etl-pipeline/etl_pipeline.py"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Get Current Date</span></span>
<span class="line"><span style="color:#E1E4E8">current_datetime</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">$(</span><span style="color:#B392F0">date</span><span style="color:#9ECBFF"> '+%d-%m-%Y_%H-%M'</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Append Current Date in the Log File</span></span>
<span class="line"><span style="color:#E1E4E8">log_file</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"/home/mad4869/Documents/pacmann/data-engineering/etl-pipeline/logs/etl_</span><span style="color:#E1E4E8">$current_datetime</span><span style="color:#9ECBFF">.log"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Run Python Script and Insert Log</span></span>
<span class="line"><span style="color:#B392F0">python</span><span style="color:#9ECBFF"> "</span><span style="color:#E1E4E8">$PYTHON_SCRIPT</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> >></span><span style="color:#9ECBFF"> "</span><span style="color:#E1E4E8">$log_file</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> 2>&#x26;1</span></span>
<span class="line"></span></code></pre>
<p>The crontab for running the shell script regularly:</p>
<!-- ![Crontab](/docs/crontab.png) -->
<h3 id="testing-scenario">Testing Scenario</h3>
<h4 id="scenario-1">Scenario 1</h4>
<p>Scenario 1 focuses on ensuring the pipeline runs without any issue and the data is successfully loaded to their respective tables within the database.</p>
<!-- ![Luigi Execution Summary](/docs/luigi.png) -->
<p>Products table:</p>
<!-- ![Products Table in the Database](/docs/scenario-1-products.png) -->
<p>Sales table:</p>
<!-- ![Sales Table in the Database](/docs/scenario-1-sales.png) -->
<p>Web table:</p>
<!-- ![Web Table in the Database](/docs/scenario-1-web.png) -->
<h4 id="scenario-2">Scenario 2</h4>
<p>Scenario 2 verifies that the pipeline executes regularly within the scheduler and can successfully ingest newly inserted data from the database source.</p>
<p>The state of the database before inserting a new record:</p>
<!-- ![Database before inserting a new record](/docs/scenario-2-a.png) -->
<p>The state of the database after inserting a new record:</p>
<!-- ![Database after inserting a new record](/docs/scenario-2-b.png) -->
<h2 id="conclusion">Conclusion</h2>
<p>This document outlines the construction of a basic ETL pipeline. While further enhancements, particularly in the data transformation stage, can refine this pipeline, it already demonstrates the capability of performing end-to-end data processing.</p> </article> </main>  <footer class="flex items-center justify-between w-screen px-16 py-4 text-xs border-t border-fuchsia-400 text-fuchsia-400"> <p>&copy; 2024. All rights reserved.</p> <span class="flex items-center gap-2"> <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4-8 5-8-5V6l8 5 8-5v2z"></path></svg> <a href="mailto:mad4869@gmail.com" target="_blank" title="Reach via email" class="hover:underline">mad4869@gmail.com</a> </span> </footer>  </body> </html>